<html>
<head>
<style>
.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: .4s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: #4CAF50;
}
input:checked + .slider:before {
  transform: translateX(26px);
}
</style>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const q = new URLSearchParams(window.location.search);
  const scUid = q.get("sc_uid");  // kommt aus dem Mail-Tracking
 
  if (scUid) {
    const uidField = document.querySelector('#ProfileForm [name="UID"]');
    if (uidField) uidField.value = scUid;
  }
});
</script>

</head>
<form id="ProfileForm" name="ProfileForm" onsubmit="return CheckInputs();" action="https://link.opo.ch/u/register.php" method="get">
<input type=hidden name="CID" value="790867401"><input type=hidden name="SID" value=""><input type=hidden name="UID" value=""><input type=hidden name="f" value="1422"><input type=hidden name="p" value="2"><input type=hidden name="a" value="r"><input type=hidden name="el" value=""><input type=hidden name="llid" value=""><input type=hidden name="c" value=""><input type=hidden name="counted" value=""><input type=hidden name="RID" value=""><input type=hidden name="mailnow" value="">
<h3>Marketing Preference Center OPO Oeschger</h3>
<p>Wir freuen uns, dass Sie Ihre Daten aktualisieren möchten. Im unten ersichtlichen Formular können Sie die Daten zu Ihrer Person und Ihren Marketing-Präferenzen schnell und einfach anpassen.
</p>
<h3>Kontaktdaten</h3>
Vorname:<input type=text name="inp_1" maxlength=60 value=""><br>
Nachname:<input type=text name="inp_2" maxlength=60 value=""><br>
Telefonnummer (Direktwahl / Festnetz):<input type=text name="inp_15" maxlength=60 value=""><br>
Telefonnummer (Mobil):<input type=text name="inp_37" maxlength=60 value=""><br>
<h3>Marketing Präferenzen</h3>
Newsletter Rubriken:
<input type=checkbox name="inp_4050[]" value="1">Rubrik Schreiner und Innenausbauer
<input type=checkbox name="inp_4050[]" value="2">Rubrik Zimmerleute
<input type=checkbox name="inp_4050[]" value="3">Rubrik Glas- und Metallbauer
<input type=checkbox name="inp_4050[]" value="4">Rubrik Schulen (Werkraumeinrichtungen)<br>
OPO Hit (Neue Aktionen):
<input type=checkbox name="inp_14976[]" value="2">Zimmerleute
<input type=checkbox name="inp_14976[]" value="3">Glas- und Metalbauer
<input type=checkbox name="inp_14976[]" value="4">Schulen (Werkraumeinrichtungen)<br>
OPO News (Neue Produkte):
<input type=checkbox name="inp_15016[]" value="1">Schreiner und Innenausbauer<br>

<!-- SWITCHES ersetzt ursprüngliche Felder -->
<label>Promotionen (Special Friday):</label>
<label class="switch">
  <input type="checkbox" id="switch_promo" name="inp_15378_switch" />
  <span class="slider"></span>
</label><br>
<label>Events (Seminare, Webinare etc.):</label>
<label class="switch">
  <input type="checkbox" id="switch_events" name="inp_14978_switch" />
  <span class="slider"></span>
</label><br>
<h3>Bevorzugte Kommunikationskanäle</h3>
<label>E-Mail:</label>
<label class="switch">
  <input type="checkbox" id="switch_doi" name="inp_6180_switch" />
  <span class="slider"></span>
</label><br>
<label>SMS:</label>
<label class="switch">
  <input type="checkbox" id="switch_sms" name="inp_1198_switch" />
  <span class="slider"></span>
</label><br>
<label>Print (für OPO News und Hit):</label>
<label class="switch">
  <input type="checkbox" id="switch_print" name="inp_14979_switch" />
  <span class="slider"></span>
</label><br>

<!-- Hidden inputs zur Integration mit bestehender Logik -->
<input type=hidden name="inp_15378" id="inp_15378" value="">
<input type=hidden name="inp_14978" id="inp_14978" value="">
<input type=hidden name="inp_6180" id="inp_6180" value="">
<input type=hidden name="inp_1198" id="inp_1198" value="">
<input type=hidden name="inp_14979" id="inp_14979" value="">

<input aria-label="Speichern" tabindex="993" type="button" onclick="SubmitIt()" name="submit1" value="Präferenzen Speichern">
</form>

<script language="javascript">
function onbeforesubmit()
{
return true;
}
</script>
<script language="javascript">

	var error;
var form_lanuage = 'en';

function is_1_valid(input)
{
	if(input == "")
	{
		error += "First Name: missing data!\n";
		return false;
	}

	return true;
}
function is_2_valid(input)
{
	if(input == "")
	{
		error += "Last Name: missing data!\n";
		return false;
	}

	return true;
}
</script>

<script>
function getForm() {
  return document.getElementById('ProfileForm')
      || document.forms['ProfileForm']
      || document.querySelector('form[name="ProfileForm"]');
}
</script>

<script>
function CheckInputs() {
  var frm = getForm();
  if (!frm) {
    alert('Form "ProfileForm" nicht gefunden.');
    return false;
  }

  var errorMsg = "Bitte füllen sie folgende Felder aus\n";
  var ok = true;

  var first = frm.elements['inp_1'];
  var last = frm.elements['inp_2'];

  if (!first || !first.value) { errorMsg += "Bitte füllen sie das Feld Vorname aus\n"; ok = false; }
  if (!last || !last.value) { errorMsg += "Bitte füllen sie das Feld Nachname aus\n"; ok = false; }

  if (!ok) alert(errorMsg);
  return ok;
}
</script>
<script>
function rebuildMultiGroupExact(form, groupName) {
  // 1) Alle Checkboxen im Formular mit diesem Namen finden (bevor sie gelöscht werden!)
  const checkedValues = [...form.querySelectorAll(`input[type="checkbox"][name="${groupName}"]:checked`)]
    .map(cb => cb.value);

  // 2) Alte Felder mit diesem Namen entfernen (Checkboxen UND evtl. alte hidden)
  [...form.querySelectorAll(`input[name="${groupName}"]`)].forEach(n => n.remove());

  // 3) Immer ein leeres Hidden schicken → neutralisiert alte Werte
  const clear = document.createElement('input');
  clear.type = 'hidden';
  clear.name = groupName;
  clear.value = '';
  form.appendChild(clear);

  // 4) Für jede angehakte Checkbox ein Hidden hinzufügen
  checkedValues.forEach(val => {
    const h = document.createElement('input');
    h.type = 'hidden';
    h.name = groupName;
    h.value = val;
    form.appendChild(h);
  });
}
</script>

<script>
// ggf. deine Helfer: getForm(), rebuildMultiGroupExact(...) etc. vorher laden

function SubmitIt(){
  const frm = getForm();
  if (!frm) { 
    alert('Form "ProfileForm" nicht gefunden.'); 
    return; 
  }

  // 1) Switches → Hidden (1/2)
  document.getElementById("inp_15378").value = document.getElementById("switch_promo").checked  ? "1" : "2";
  document.getElementById("inp_14978").value = document.getElementById("switch_events").checked ? "1" : "2";
  document.getElementById("inp_6180").value  = document.getElementById("switch_doi").checked    ? "1" : "2";
  document.getElementById("inp_1198").value  = document.getElementById("switch_sms").checked    ? "1" : "2";
  document.getElementById("inp_14979").value = document.getElementById("switch_print").checked  ? "1" : "2";

  // 2) Mehrfachfelder exakt neu aufbauen
  rebuildMultiGroupExact(frm, 'inp_4050[]');   // Newsletter Rubriken
  rebuildMultiGroupExact(frm, 'inp_14976[]');  // OPO Hit
  rebuildMultiGroupExact(frm, 'inp_15016[]');  // OPO News

  // 3) Validierung
  if (!CheckInputs()) return;

  // 4) echter Submit
  frm.submit();
}
</script>


<script>
function MailIt(){
    if(CheckInputs()){
        if((document.ProfileForm.subject.value=='') || (document.ProfileForm.msg.value==''))
            alert('Bitte f\u00fcr Sie die Nachrichtenfelder aus!');
        else
            document.ProfileForm.submit();
    }
}
</script>

<script>
function FieldWithName(frm, fieldname, numofield)
{
    if(!numofield)
        numofield = 0;
    field_count = 0;
    for(i = 0; i < frm.elements.length; ++i)
    {
        if(frm.elements[i].name == fieldname)
        {
            if(field_count == numofield)
                return frm.elements[i];
            else
                field_count++;
        }
    }
}
</script>

<script>
function NumChecked(frm, fieldname)
{
		var count = 0;
		for(i = 0; i < frm.elements.length; ++i)
		{
				if(frm.elements[i].name == fieldname && frm.elements[i].checked == true) 	
						++count;
		}
		return count;
}
</script>

<script>
function NumSel(field)
{
    var count = 0;
    for(i = 0; i < field.length; ++i)
        if(field[i].selected == true) ++count;
    return count;
}
</script>

<script>
function prefillSwitches() {
  const urlParams = new URLSearchParams(window.location.search);

  const valPromo = urlParams.get("inp_15378");
  document.getElementById("switch_promo").checked = valPromo === "TRUE";
  document.getElementById("inp_15378").value = valPromo === "TRUE" ? "1" : "2";

  const valEvents = urlParams.get("inp_14978");
  document.getElementById("switch_events").checked = valEvents === "TRUE";
  document.getElementById("inp_14978").value = valEvents === "TRUE" ? "1" : "2";

  const valDOI = urlParams.get("inp_6180");
  document.getElementById("switch_doi").checked = valDOI === "TRUE";
  document.getElementById("inp_6180").value = valDOI === "TRUE" ? "1" : "2";

  const valSMS = urlParams.get("inp_1198");
  document.getElementById("switch_sms").checked = valSMS === "TRUE";
  document.getElementById("inp_1198").value = valSMS === "TRUE" ? "1" : "2";

  const valPrint = urlParams.get("inp_14979");
  document.getElementById("switch_print").checked = valPrint === "TRUE";
  document.getElementById("inp_14979").value = valPrint === "TRUE" ? "1" : "2";
}
</script>
<script language="javascript">
var multiFields = new Array();
var dateFields = new Array();
multiFields["interest[]"] = "interest"
multiFields["optin"] = "optin"
var arr_interest = new Array();
multiFields["inp_4050[]"]=4050;
arr_4050 = new Array();
arr_4050["Rubrik Schulen (Werkraumeinrichtungen)"] = "4";
arr_4050["Rubrik Schreiner und Innenausbauer"] = "1";
arr_4050["Rubrik Glas- und Metallbauer"] = "3";
arr_4050["Rubrik Zimmerleute"] = "2";
multiFields["inp_14976[]"]=14976;
arr_14976 = new Array();
arr_14976["Schulen (Werkraumeinrichtungen)"] = "4";
arr_14976["Glas- und Metalbauer"] = "3";
arr_14976["Zimmerleute"] = "2";
multiFields["inp_15016[]"]=15016;
arr_15016 = new Array();
arr_15016["Schreiner und Innenausbauer"] = "1";
</script>
<script>
(function fixBracketParamsInUrl() {
  if (window.location.search.includes('%5B') || window.location.search.includes('%5D')) {
    const fixedSearch = decodeURIComponent(window.location.search);
    const newUrl = window.location.origin + window.location.pathname + fixedSearch;
    window.history.replaceState(null, '', newUrl);
  }
})();
</script>

<script language="javascript" src="https://link.opo.ch/u/nprefill.js" type="text/javascript"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  preFill();
  prefillSwitches();
});
</script>
</html>
